CREATE DATABASE FOOD;
USE FOOD;

CREATE TABLE users(
    user_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    full_name VARCHAR(255),
    email  VARCHAR(255),
    password VARCHAR(255) 
);

CREATE TABLE restaurant(
    res_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    res_name VARCHAR(255),
    image  VARCHAR(255),
    description VARCHAR(255) 
);
CREATE TABLE food_type(
    type_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    type_name VARCHAR(255) 
);
CREATE TABLE food(
    food_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    food_name VARCHAR(255), 
    image VARCHAR(255),
    price FLOAT,
    description VARCHAR(255),
    type_id INT,
    FOREIGN KEY(type_id) REFERENCES food_type(type_id)
);
CREATE TABLE sub_food(
    sub_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    sub_name VARCHAR(255), 
    sub_price FLOAT,
    food_id INT ,
    FOREIGN KEY(food_id) REFERENCES food(food_id)
);

CREATE TABLE order(
    user_id INT ,
    FOREIGN KEY(user_id) REFERENCES users(user_id),
    food_id INT,
    FOREIGN KEY(food_id ) REFERENCES food(food_id),
    amount INT,
    code VARCHAR(255),
    arr_sub_id VARCHAR(255)  
);
CREATE TABLE order_res(
    user_id INT,
    FOREIGN KEY(user_id ) REFERENCES users(user_id),
    res_id INT ,
    FOREIGN KEY( res_id) REFERENCES restaurant(res_id),
    amount INT,
    code VARCHAR(255),
    arr_sub_id VARCHAR(255)    
);
CREATE TABLE like_res(
    user_id INT ,
    FOREIGN KEY(user_id) REFERENCES users(user_id),
    res_id INT ,
    FOREIGN KEY(res_id) REFERENCES restaurant(res_id),
    date_like DATETIME,
);

CREATE TABLE rate_res(
    user_id INT,
    FOREIGN KEY(user_id ) REFERENCES users(user_id),
    res_id INT ,
    FOREIGN KEY( res_id) REFERENCES restaurant(res_id),
    amount INT,
    date_rate DATETIME 
);
# Tìm 5 người đã like nhà hàng nhiều nhất.
SELECT *
FROM like_res
ORDER BY user_id DESC
LIMIT 5;
# Tìm 2 nhà hàng có lượt like nhiều nhất.
SELECT *
FROM rate_res
ORDER BY amount DESC
LIMIT 2;
# Tìm người đã đặt hàng nhiều nhất
SELECT MAX(amount)
FROM order_res;
# Tìm người dùng không hoạt động trong hệ thống
# (không đặt hàng, không like, không đánh giá nhà
# hàng).
SELECT amount
FROM order_res
WHERE amount=NULL AND SELECT amount
FROM rate_res
WHERE amount=NULL AND SELECT amount
FROM l date_like 
WHERE date_like =NULL 
# Tính trung bình sub_food của một food.
SELECT AVG( sub_price )
FROM sub_food;
